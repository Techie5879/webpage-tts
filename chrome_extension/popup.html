<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Webpage TTS</title>
    <link rel="stylesheet" href="popup.css" />
  </head>
  <body>
    <div class="app">
      <header class="header">
        <div class="title">Webpage TTS</div>
        <div class="subtitle">Local MLX Qwen3-TTS voices, straight from your browser.</div>
      </header>

      <section class="card">
        <label class="label" for="serverUrl">Server URL</label>
        <input id="serverUrl" class="input" type="text" placeholder="http://127.0.0.1:9872" />

        <div class="row">
          <div class="col">
            <label class="label" for="source">Text source</label>
            <select id="source" class="select">
              <option value="selection">Selection (fallback to page)</option>
              <option value="page">Whole page</option>
            </select>
          </div>
          <div class="col">
            <label class="label" for="playbackTarget">Playback</label>
            <select id="playbackTarget" class="select">
              <option value="offscreen">Offscreen (recommended)</option>
              <option value="popup">Popup only</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label class="label" for="chunkSize">Chunk size</label>
            <input id="chunkSize" class="input" type="number" min="200" max="1200" step="20" />
          </div>
          <div class="col">
            <label class="label" for="speaker">Custom speaker</label>
            <select id="speaker" class="select"></select>
          </div>
        </div>

        <div class="row">
          <div class="col">
            <label class="label" for="customModelSize">CustomVoice model size</label>
            <select id="customModelSize" class="select">
              <option value="0.6b">0.6B (faster)</option>
              <option value="1.7b">1.7B (higher quality)</option>
            </select>
          </div>
          <div class="col"></div>
        </div>
      </section>

      <section class="card">
        <div class="label">Mode</div>
        <div class="mode-grid">
          <button class="mode-btn" data-mode="default">Default</button>
          <button class="mode-btn" data-mode="custom">Custom Voices</button>
          <button class="mode-btn" data-mode="design">Voice Design</button>
          <button class="mode-btn" data-mode="clone">Voice Clone</button>
        </div>

        <div id="mode-default" class="mode-panel">
          <div class="hint">Uses the default voice and speaker from your server config.</div>
        </div>

        <div id="mode-custom" class="mode-panel">
          <label class="label" for="instruction">Optional style instruction</label>
          <textarea id="instruction" class="textarea" rows="2" placeholder="calm, warm, podcast style"></textarea>
        </div>

        <div id="mode-design" class="mode-panel">
          <label class="label" for="designPrompt">Voice description</label>
          <textarea id="designPrompt" class="textarea" rows="3" placeholder="A confident British narrator with a smooth, warm tone"></textarea>
          <div class="row">
            <div class="col">
              <label class="label" for="designName">Save as</label>
              <input id="designName" class="input" type="text" placeholder="My narrator" />
            </div>
            <div class="col actions-row">
              <button id="saveDesign" class="ghost">Save voice</button>
            </div>
          </div>
        </div>

        <div id="mode-clone" class="mode-panel">
          <label class="label" for="cloneAudio">Reference audio (wav/mp3)</label>
          <input id="cloneAudio" class="input" type="file" accept="audio/*" />

          <label class="label" for="cloneText">Reference text</label>
          <textarea id="cloneText" class="textarea" rows="2" placeholder="The exact words spoken in the reference audio"></textarea>

          <div class="row">
            <div class="col">
              <label class="label" for="cloneName">Save as</label>
              <input id="cloneName" class="input" type="text" placeholder="My cloned voice" />
            </div>
            <div class="col actions-row">
              <button id="saveClone" class="ghost">Save voice</button>
            </div>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="row">
          <div class="col">
            <label class="label" for="savedVoices">Saved voices</label>
            <select id="savedVoices" class="select"></select>
          </div>
          <div class="col actions-row">
            <button id="applyVoice" class="ghost">Apply</button>
            <button id="removeVoice" class="ghost danger">Remove</button>
          </div>
        </div>
      </section>

      <section class="card">
        <div class="actions">
          <button id="speak" class="primary">Speak</button>
          <button id="testTone" class="ghost">Test Tone</button>
          <button id="testTts" class="ghost">Test TTS (MLX)</button>
          <button id="pause" class="ghost">Pause</button>
          <button id="resume" class="ghost">Resume</button>
          <button id="stop" class="ghost danger">Stop</button>
        </div>
        <div id="status" class="status">Idle.</div>
      </section>
    </div>
    <script src="popup.js"></script>
  </body>
</html>
